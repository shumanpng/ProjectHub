<div class="bg-dark">
  <br>
  <div class="container bg-dark" style="color:white">
    <div class="row">
      <div class="col-md-8">
        <div class="bd-pageheader">
          <h1><%= @group.name %></h1>
          <h2 class="lead">Group.</h2>
          <% if @group.description != '' && @group.description != nil %>
            <p class="lead">
              <small class="text-muted"><%= @group.description %></small>
            </p>
          <% end %>
        </div>
      </div>
      <div class="text-right">
        <% if @is_grp_admin %>
          <%= link_to 'Group Settings', edit_group_path(:group_id => @group.id), :class => 'btn btn-warning btn-sm' %>
        <% end %>
          <%= link_to 'Create New Task', new_task_path( :groupname => @group.name), :class=>"btn btn-primary btn-sm"%>
          <%= link_to 'View All Tasks', tasks_path(:groupid => @group.id, :groupname => @group.name), :class => 'btn btn-primary btn-sm'%>
      </div>
    </div>
  </div>
  <br>
</div>
<div class="container">
  <p id="notice"><%= notice %></p>

  <!-- Bootstrap progress bar to represent time left to complete the project (based on group deadline) -->
  <% if @group.deadline != nil %>
    <div class="progress <%= 'progress-shift-left' if @overdue %>">
      <div class="progress-bar progress-bar-striped bg-success" role="progressbar" style="width: <%= @percent_completed %>%"
        aria-valuenow="<%= @percent_completed %>" aria-valuemin="0" aria-valuemax="100">

        <% if @percent_completed >= 10 %>  <!-- (if percentage is too small, writing will get cut off) -->
          <% if @days_left >= 0 %>
            <%= @days_left %> days left!
          <% else %>
            0 days left!  <!-- to avoid showing a negative number of days left -->
          <% end %>
        <% end %>

      </div>
      <% if @percent_completed < 10 %>
        <p><%= @days_left %> days left!</p>
      <% end %>
    </div>

    <% if @overdue %>
      <button type="button" data-toggle="popover" data-placement="top" data-html="true"
      data-content="<%= @warning %> <%= @warning_addition %>" id="progress-warning">
        <i class="fa fa-warning fa-fw"></i>
      </button>
    <% end %>

    <p class="progress-label start">Project started: <%= @group.created_at.localtime.to_date.strftime("%b. %-d, '%y") %></p>
    <p class="progress-label end <%= 'progress-shift-left' if @overdue %>">Project due: <%= @group.deadline.strftime("%b. %-d, '%y") %></p>

    <br></br>
  <% end %>

  <!-- if user is a group admin, display table of pending requests -->
  <% if @is_grp_admin %>
    <p class="header pending-requests">PENDING REQUESTS:</p>

    <% if @pending_requests.exists? %>
      <table class="table table-sm">
        <thead class="thead-dark">
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th colspan="2">Actions</th>
          </th>
        </thead>

        <tbody>
          <% @pending_requests.each do |request| %>
              <tr>
                <td><%= request.user.name %></td>
                <td><%= request.user.email %></td>
                <td><%= link_to respond_to_request_path(:id => request.id, :group_id => @group.id, :type => 'accept'), :class => 'table-link' do %>
                  <i class="fa fa-thumbs-up fa-fw"></i>Accept
                  <% end %>
                </td>
                <td><%= link_to respond_to_request_path(:id => request.id, :group_id => @group.id, :type => 'deny'), :class => 'table-link' do %>
                  <i class="fa fa-thumbs-down fa-fw"></i>Deny
                  <% end %>
                </td>
              </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <!-- there are no pending requests -->
      <p>No active requests to show!</p>
    <% end %>
  <% end %>

  <!-- display group members, stored in views/groups/_display_members.html.erb (a partial view) -->
  <%= render 'groups/display_members', :group => @group, :curr_user => @current_user %>

  <p>TASKS:</p>
    <%= render(
      partial: 'tasks/list_open_tasks_in_group',
      locals: { tasks: @opentasks }
    ) %>

    <%= render(
      partial: 'tasks/list_in_progress_tasks_in_group',
      locals: { tasks: @inprogresstasks }
    ) %>

    <%= render(
      partial: 'tasks/list_completed_tasks_in_group',
      locals: { tasks: @completedtasks }
    ) %>
</div>
